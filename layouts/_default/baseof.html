<!doctype html>
<html lang="{{ .Site.LanguageCode | default "en" }}">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Primary Meta Tags -->
        <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
        <meta name="title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}" />
        <meta name="description" content="{{ .Description | default .Summary | default .Site.Params.description | plainify }}" />
        <meta name="author" content="{{ .Site.Params.author }}" />
        <meta name="keywords" content="{{ with .Params.tags }}{{ delimit . ", " }}{{ else }}{{ .Site.Params.keywords }}{{ end }}" />

        <!-- Open Graph / Facebook -->
        {{ partial "opengraph.html" . }}

        <!-- Twitter -->
        {{ partial "twitter-cards.html" . }}

        <!-- Canonical URL -->
        <link rel="canonical" href="{{ .Permalink }}" />

        <!-- RSS Feed -->
        {{ with .OutputFormats.Get "rss" -}}
        <link rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" href="{{ .RelPermalink }}" />
        {{- end }}

        <!-- Your existing code -->
        <link rel="icon" href="{{ "/favicon.ico" | relLangURL }}" sizes="any" />
        <link rel="icon" type="image/png" sizes="32x32" href="{{ "/favicon-32x32.png" | relLangURL }}" />
        <link rel="icon" type="image/png" sizes="16x16" href="{{ "/favicon-16x16.png" | relLangURL }}" />
        <link rel="apple-touch-icon" sizes="180x180" href="{{ "/apple-touch-icon.png" | relLangURL }}" />
        <link rel="mask-icon" href="{{ "/safari-pinned-tab.svg" | relLangURL }}" color="#5bbad5" />

        <!-- Additional recommended tags -->
        <link rel="manifest" href="{{ "/site.webmanifest" | relLangURL }}" />
        <meta name="msapplication-TileColor" content="#ffffff" />
        <meta name="theme-color" content="#ffffff" />
        <!-- Your existing (and better) CSS method -->
        {{ $styles := resources.Get "styles.css" | resources.Fingerprint }}
        <link
            rel="stylesheet"
            href="{{ $styles.RelPermalink }}"
            integrity="{{ $styles.Data.Integrity }}"
        />
        <noscript><link rel="stylesheet" href="{{ $styles.RelPermalink }}" /></noscript>

        <!-- Preload critical images -->
        {{- $imagePath := .Params.image | default .Site.Params.defaultSocialImage -}}
        {{- with resources.Get $imagePath -}}
        {{- $processed := .Fill "1200x630 Center q85 jpg" -}}
        <link rel="preload" as="image" href="{{ $processed.Permalink }}">
        {{- end -}}
    </head>

    <body class="">
        <!-- The class will be managed by JavaScript for dark mode -->

        <!-- We will add a header partial here later -->
        {{ partial "header.html" . }}

        <main>
            <!-- This is where page-specific content will be injected -->
            {{ block "main" . }}{{ end }}
        </main>

        {{ partial "footer.html" . }}

        <!-- We will add the theme-toggle script here -->
        <script>
            const themeToggle = document.getElementById("theme-toggle");
            const body = document.body;

            // Function to set the theme
            const setTheme = (theme) => {
                if (theme === "dark") {
                    body.classList.add("theme-dark");
                    localStorage.setItem("theme", "dark");
                } else {
                    body.classList.remove("theme-dark");
                    localStorage.setItem("theme", "light");
                }
            };

            // Check for saved theme in localStorage or user's system preference
            const savedTheme = localStorage.getItem("theme");
            const prefersDark = window.matchMedia(
                "(prefers-color-scheme: dark)",
            ).matches;

            if (savedTheme) {
                setTheme(savedTheme);
            } else if (prefersDark) {
                setTheme("dark");
            }

            // Add click event listener to the toggle
            if (themeToggle) {
                themeToggle.addEventListener("click", () => {
                    if (body.classList.contains("theme-dark")) {
                        setTheme("light");
                    } else {
                        setTheme("dark");
                    }
                });
            }
        </script>
    </body>
</html>
